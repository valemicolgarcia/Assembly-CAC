PIO EQU 30H
;PA
;PB
;CA
;CB

ORG 1000H
 CADENA db "AbCd"
 FIN db ?
 A db "A"
 Z db "Z"

ORG 3000H

 INI_IMP: PUSH AX

 MOV AL, 0FDH ; 1111 1101B
 OUT PIO+2, AL
 MOV AL, 0
 OUT PIO+3, AL
 IN AL, PIO
 AND AL, 0FDH ;inicializo en 0 el bit de strobe
 OUT PIO, AL
 
 POP AX
 RET
 
 SELECCIONADO: PUSH AX
 PUSH BX
 PUSH CX
 MOV CL, A
 MOV CH, Z
 INC CH
 LAZO: CMP AL, CL
 JZ VERDADERO
 INC CL
 CMP CL, CH
 JNZ LAZO
 MOV DL, 0
 JMP FINN
 VERDADERO: MOV DL, 1
 FINN: POP CX
 POP BX
 POP AX
 RET

 ORG 4000H
PULSO: PUSH AX
  IN AL, PIO
  OR AL, 02H ;0000 0010 --> strobe en 1
  OUT PIO, AL
  IN AL, PIO
  AND AL, 0FDH ; 1111 1101 --> strobe en 0
  OUT PIO, AL
 POP AX
 RET


ORG 2000H

 CALL INI_IMP
 MOV BX, OFFSET CADENA
 MOV CL, OFFSET FIN - OFFSET CADENA 
 
 LOOP: MOV AL, [BX]
  CALL SELECCIONADO
  CMP DL, 1
  JNZ SALTEO
  PUSH AX
  POLL: IN AL, PIO ;-->CONSULTA DE ESTADO
  AND AL, 1
  JNZ POLL
  POP AX
  OUT PIO+1, AL
  CALL PULSO
  SALTEO: INC BX
  DEC CL
 JNZ LOOP
 
 

INT 0
END