PIC EQU 20H
EOI EQU 20H
PIO EQU 30H
TIMER EQU 10H
N_CLK EQU 10

ORG 40
 IP_CLK DW RUT_CLK

ORG 1200H
 NUM DB ?


ORG 1000H
 MASC DB 1
 
ORG 2000H

 CLI
 ;CONFIGURACION DEL PIC
 MOV AL, 11111101B ;0FDH -->prendo el clock
 OUT PIC+1, AL
 MOV AL, N_CLK
 OUT PIC+5, AL
 ;CONFIGURACION DEL TIMER
 MOV AL, 1
 OUT TIMER+1, AL
 MOV AL, 0
 OUT TIMER, AL
 ;CONFIGURACION DEL PIO
 MOV AL,0
 OUT PIO+3, AL ;CB:0000 0000
 OUT PIO+1, AL ;PB:0000 0000

 ;LECTURA DE LOS CINCO NUMEROS
 MOV BX, OFFSET NUM
 MOV CL, 5
 LOOP: INT 6
 INC BX
 DEC CL
 JNZ LOOP
 ;INICIALIZACION DE LA DIREC
 MOV BX, OFFSET NUM
 STI
 
 LAZO: CMP CL, 5
 JNZ LAZO

ORG 3000H

RUT_CLK: PUSH AX
CMP CL,5
JZ FIN
MOV AL,[BX]
SUB AL, 30H ;resto 30 porque el 0 es 30h
MOV DL, MASC
CALL ROTARIZ
MOV AL, DL
OUT PIO+1, AL
INC BX
INC CL
;FIN DE LA INTERRUPCION
FIN:MOV AL, 0
OUT TIMER, AL
MOV AL, EOI
OUT EOI, AL
POP AX
IRET

ROTARIZ: ADD DL, DL ;CORRO LOS BITS
JNC SALTAR
INC DL
SALTAR: DEC AL ; POSICIONES A ROTAR
JNZ ROTARIZ
RET


INT 0
END